<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hours For Shelby</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #F3EAD3;
            --bg-secondary: #FFFFFF;
            --text-primary: #4A4A4A;
            --text-secondary: #7A7A7A;
            --accent-primary: #86A8E7;
            --accent-secondary: #91EAE4;
            --border-default: #D9D9D9;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-primary); color: var(--text-primary); transition: background-color 0.5s ease, color 0.5s ease; }
        .card { background-color: var(--bg-secondary); border-radius: 1.5rem; box-shadow: 0 10px 25px -5px var(--shadow-color), 0 8px 10px -6px var(--shadow-color); transition: background-color 0.5s ease, box-shadow 0.5s ease; }
        .btn { border-radius: 0.75rem; transition: transform 0.2s ease, background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease; }
        .btn:active { transform: scale(0.95); }
        .btn-primary { background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); color: white; border-color: transparent; }
        .btn-secondary { background-color: transparent; border: 1px solid var(--accent-primary); color: var(--accent-primary); }
        .btn-danger { background-color: #E74C3C; color: white; border-color: transparent; }
        .input-field { background-color: var(--bg-primary); border: 1px solid transparent; border-radius: 0.75rem; transition: background-color 0.3s ease, border-color 0.3s ease; padding: 0.5rem 0.75rem; cursor: text; }
        .input-field:focus { outline: none; border-color: var(--accent-primary); background-color: var(--bg-secondary); }
        #notification-toast { position: fixed; bottom: 1.25rem; right: 1.25rem; z-index: 100; opacity: 0; transform: translateY(2rem); transition: opacity 0.3s ease, transform 0.3s ease; }
        #notification-toast.show { opacity: 1; transform: translateY(0); }
        #timesheet-output { font-family: 'Courier New', Courier, monospace; white-space: pre; background-color: var(--bg-primary); }
        .modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 50; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        .modal-backdrop.active { opacity: 1; pointer-events: auto; }
        .modal-content { transform: scale(0.7); opacity: 0; transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.2s ease-out; }
        .modal-backdrop.active .modal-content { transform: scale(1); opacity: 1; }
        #achievement-toast { position: fixed; bottom: 1.25rem; left: 1.25rem; z-index: 110; opacity: 0; transform: translateY(2rem); transition: opacity 0.5s cubic-bezier(0.22, 1, 0.36, 1), transform 0.5s cubic-bezier(0.22, 1, 0.36, 1); pointer-events: none; }
        #achievement-toast.show { opacity: 1; transform: translateY(0); pointer-events: auto; }
        .achievement-item { opacity: 0.5; filter: grayscale(80%); transition: all 0.3s ease; }
        .achievement-item.unlocked { opacity: 1; filter: grayscale(0%); }
    </style>
</head>
<body class="antialiased">

    <div id="background-animation-container"></div>

    <div class="min-h-screen p-4 sm:p-6 lg:p-8">
        <div class="max-w-5xl mx-auto">
            <header class="flex justify-between items-center mb-8">
                <h1 class="text-3xl font-bold tracking-tight text-primary">Hours For Shelby.</h1>
                <button id="settings-btn" class="p-3 rounded-full hover:bg-black/10 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                </button>
            </header>
            <div class="flex justify-center items-center gap-4 sm:gap-8 mb-8">
                <button id="clock-in-btn" class="btn btn-primary flex-1 max-w-xs py-4 px-6 text-xl font-bold shadow-lg flex items-center justify-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sunrise"><path d="M17 18a5 5 0 0 0-10 0"></path><line x1="12" y1="2" x2="12" y2="9"></line><line x1="4.22" y1="10.22" x2="5.64" y2="8.8"></line><line x1="1" y1="18" x2="3" y2="18"></line><line x1="21" y1="18" x2="23" y2="18"></line><line x1="18.36" y1="8.8" x2="19.78" y2="10.22"></line><line x1="12" y1="23" x2="12" y2="18"></line><polyline points="16 5 12 9 8 5"></polyline></svg><span>Clock In</span></button>
                <button id="clock-out-btn" class="btn btn-secondary flex-1 max-w-xs py-4 px-6 text-xl font-bold shadow-lg flex items-center justify-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sunset"><path d="M17 18a5 5 0 0 0-10 0"></path><line x1="12" y1="9" x2="12" y2="2"></line><line x1="4.22" y1="10.22" x2="5.64" y2="8.8"></line><line x1="1" y1="18" x2="3" y2="18"></line><line x1="21" y1="18" x2="23" y2="18"></line><line x1="18.36" y1="8.8" x2="19.78" y2="10.22"></line><line x1="12" y1="23" x2="12" y2="18"></line><polyline points="16 5 12 9 8 5"></polyline></svg><span>Clock Out</span></button>
            </div>
            <main class="space-y-8">
                <div id="calendar-card" class="card p-6">
                    <div class="flex justify-between items-center mb-4"><button id="prev-month-btn" class="p-2 rounded-full hover:bg-black/10 transition-colors">&lt;</button><h2 id="month-year-header" class="text-xl font-bold"></h2><button id="next-month-btn" class="p-2 rounded-full hover:bg-black/10 transition-colors">&gt;</button></div>
                    <div id="calendar-grid" class="grid grid-cols-7 gap-2 text-center max-w-md mx-auto"></div>
                </div>
                <div class="card p-6">
                    <h3 class="text-lg font-semibold mb-4">Summary</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center">
                        <div><p class="text-sm text-secondary">Today</p><p id="summary-today" class="text-2xl font-bold">0.00h</p></div>
                        <div><p class="text-sm text-secondary">Pay Period</p><p id="summary-pay-period" class="text-2xl font-bold">0.00h</p></div>
                        <div><p class="text-sm text-secondary">Total</p><p id="summary-total" class="text-2xl font-bold">0.00h</p></div>
                    </div>
                </div>
                <div class="flex justify-center gap-4"><button id="turn-in-hours-btn" class="btn btn-primary font-bold py-3 px-8 text-lg">Turn In Hours</button><button id="view-stats-btn" class="btn btn-secondary font-bold py-3 px-8 text-lg">View Stats</button></div>
            </main>
        </div>
    </div>
    <div id="side-panel-container"><div id="side-panel-backdrop"></div><div id="side-panel-content" class="card !rounded-l-3xl !rounded-r-none p-6 flex flex-col"><div class="flex justify-between items-center mb-2"><h3 class="text-lg font-semibold">Selected Day</h3><button id="close-side-panel-btn" class="p-2 rounded-full hover:bg-black/10 transition-colors">&times;</button></div><p id="display-selected-date" class="text-sm text-secondary mb-6">Select a date</p><div class="flex-grow overflow-y-auto pr-2"><button id="add-session-btn" title="Add New Session" class="w-full btn btn-secondary mb-4">Add Session</button><div id="sessions-display-area" class="space-y-3 mb-4"></div><div id="additional-hours-display-area" class="space-y-2 mb-4"></div></div><hr class="my-4 border-dashed"><div class="flex justify-between items-center"><span class="font-bold text-lg">Total for Day:</span><span id="display-day-total" class="font-bold text-xl" style="color: var(--accent-primary);">0.00h</span></div><p id="no-hours-message" class="text-center text-secondary py-8 hidden">No hours logged for this day.</p></div></div>
    <div id="time-entry-modal" class="modal-backdrop"><div class="modal-content card w-full max-w-md m-4 p-6"><div class="flex justify-between items-center mb-4"><h3 id="modal-title" class="text-lg font-semibold">Log Hours</h3><button id="close-entry-modal-btn" class="p-2 rounded-full hover:bg-black/10 transition-colors">&times;</button></div><p id="modal-selected-date" class="text-sm text-secondary mb-6"></p><div class="space-y-6"><div id="time-in-container"><label class="text-sm font-medium">Time In</label><input id="time-in" type="time" class="input-field w-full mt-1"></div><div id="time-out-container"><label class="text-sm font-medium">Time Out</label><input id="time-out" type="time" class="input-field w-full mt-1"></div><div id="hour-type-container"><label class="text-sm font-medium mb-2 block">Type</label><div class="grid grid-cols-2 gap-2"><button data-type="CORE" class="hour-type-btn btn font-semibold py-2">CORE</button><button data-type="ACAP" class="hour-type-btn btn font-semibold py-2">ACAP</button></div></div><div id="additional-hours-container"><label class="text-sm font-medium">Additional Hours (optional)</label><input id="additional-hours" type="number" step="0.01" placeholder="e.g., 1.5" class="input-field w-full mt-1"></div><button id="save-btn" class="btn btn-primary w-full py-3 font-bold !mt-8">Save Hours</button></div></div></div>
    <div id="settings-modal" class="modal-backdrop"><div class="modal-content card w-full max-w-md m-4 max-h-[90vh] overflow-y-auto p-6"><div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-bold">Settings</h2><button id="close-settings-modal-btn" class="p-2 rounded-full hover:bg-black/10 transition-colors">&times;</button></div><div class="space-y-6"><div><label for="theme-select" class="block text-sm font-medium mb-1">Color Theme</label><select id="theme-select" class="input-field w-full"></select></div><div><label for="background-select" class="block text-sm font-medium mb-1">Animated Background</label><select id="background-select" class="input-field w-full"><option value="none">None</option><option value="gradient">Animated Gradient</option></select></div><div><label for="pay-period-select" class="block text-sm font-medium mb-1">Pay Period</label><select id="pay-period-select" class="input-field w-full"><option value="7">Weekly</option><option value="14" selected>Bi-Weekly</option><option value="15">Semi-Monthly</option><option value="30">Monthly</option></select></div><button id="view-achievements-btn" class="btn btn-secondary w-full py-2">View Achievements</button><button id="clear-data-btn" class="btn btn-danger w-full py-2">Clear All Data</button></div></div></div>
    <div id="stats-modal" class="modal-backdrop"><div class="modal-content card w-full max-w-3xl m-4 max-h-[90vh] overflow-y-auto p-6"><div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-bold">Historical Stats</h2><button id="close-stats-modal-btn" class="p-2 rounded-full hover:bg-black/10 transition-colors">&times;</button></div><div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center"><div class="md:col-span-2"><canvas id="weekly-hours-chart"></canvas></div><div><canvas id="type-breakdown-chart"></canvas></div><div id="stats-no-data-message" class="text-center text-secondary py-8 hidden"><p>Log some more hours to see your stats here.</p></div></div></div></div>
    <div id="confirm-modal" class="modal-backdrop"><div class="modal-content card w-full max-w-sm m-4 p-6 text-center"><h3 id="confirm-message" class="text-lg font-medium mb-6">Are you sure?</h3><div class="flex justify-center gap-4"><button id="confirm-cancel-btn" class="btn btn-secondary w-full py-2">Cancel</button><button id="confirm-ok-btn" class="btn btn-danger w-full py-2">Confirm</button></div></div></div>
    <div id="clock-out-type-modal" class="modal-backdrop"><div class="modal-content card w-full max-w-sm m-4 p-6 text-center"><h3 class="text-lg font-medium mb-6">What type of hours?</h3><div class="flex flex-col gap-4"><button id="confirm-acap-btn" class="btn btn-primary w-full py-3 font-bold">ACAP</button><button id="confirm-core-btn" class="btn btn-primary w-full py-3 font-bold">CORE</button><button id="clock-out-cancel-btn" class="btn btn-secondary w-full py-2 mt-2">Cancel</button></div></div></div>
    <div id="timesheet-modal" class="modal-backdrop"><div class="modal-content card w-full max-w-lg m-4 p-6"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-semibold">Generated Timesheet</h3><button id="close-timesheet-modal-btn" class="p-2 rounded-full hover:bg-black/10 transition-colors">&times;</button></div><textarea id="timesheet-output" readonly class="w-full h-64 p-2 border rounded-lg input-field resize-none"></textarea><div class="flex flex-col gap-4 mt-4"><button id="copy-timesheet-btn" class="btn btn-primary w-full py-2">Copy Timesheet</button><button id="close-timesheet-btn-bottom" class="btn btn-secondary w-full py-2">Close Window</button></div></div></div>
    <div id="achievements-modal" class="modal-backdrop"><div class="modal-content card w-full max-w-lg m-4 p-6 max-h-[90vh] flex flex-col"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-semibold">Achievements</h3><button id="close-achievements-modal-btn" class="p-2 rounded-full hover:bg-black/10 transition-colors">&times;</button></div><div id="achievements-list" class="flex-grow overflow-y-auto pr-2 space-y-3"></div></div></div>
    <div id="notification-toast" class="card py-3 px-5"><p id="notification-message"></p></div>
    <div id="achievement-toast" class="card p-4 flex items-center gap-4 max-w-xs w-full"><div id="achievement-icon" class="text-3xl">🏆</div><div><p id="achievement-title" class="font-bold text-primary"></p><p id="achievement-description" class="text-sm text-secondary"></p></div></div>
    <audio id="achievement-chime" src="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTSEUAAAABAAAAmGFjdXN0aWNhX2lkX2FjdXN0aWNhX2Rvd19fVVNlcnNfX2pvcmRhbl9fRG93bmxvYWRzX19maW5hbF9wcm9qZWN0X3dlYnNpdGVfX3NvdW5kX19ub3RpZmljYXRpb25fYmVsbC5tcDMAAABoAAAAANIAAAAAATEwMCoAYeZNTEsAAAAAAAAAAADYAZCGzZ4AAAAAAAAAAAAAADYAZCGsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//vAxADgBwHABAAAFpveWFsdHktZnJlZS1zb3VuZC1jcmVhdG9yLWFjdXN0aWNhaWQuY29tLy9zYW1wbGVzLzM3NjgwOS1ub3RpZmljYXRpb24tYmVsbAANIAAAAAATEwMCoAYeZNTEsAAAAAAAAAAADYAZCGzZ4AAAAAAAAAAAAAADYAZCGsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//vAxAsAKTwjAAAAARAAAEZmaW5hbF9wcm9qZWN0X3dlYnNpdGVfX3NvdW5kX19ub3RpZmljYXRpb25fYmVsbC5tcDMAAAAZZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm_//vAxA4BKYeLAAAEAAAEFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//vAxBYAIjYfAAAAARAAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVXlVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV-pivVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV-DáAAAAARAAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVXlVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV-D/s/+z/7//s/+z/7P/s//oP/oP+///s/+///+g/+g/8AAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV-D/s/+z/3V/9n/3P/pVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV-gA//gP/g/83+///s/+z/+v/9//2AAAAAVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV-D/s/+z/oAAP/gAA/+/9gAD/wD/s/+z/3V/9n/3P/pVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//vAxC4BKYeLAAAAQAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//vAxBYAIjYfAAAAARAAAFVVVVVV-D/s/+z/3V/9n/3P/pVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//vAxC4AihofAAAAQAAA//vAxC4BKYeLAAAAQAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//vAxBYAIjYfAAAAARAAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVXlVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV-g'-'></audio>

    <script>
        window.onload = function() {
            try {
                // --- DOM ELEMENTS (safe to assume they exist) ---
                const calendarGrid = document.getElementById('calendar-grid');
                const monthYearHeader = document.getElementById('month-year-header');
                const prevMonthBtn = document.getElementById('prev-month-btn');
                const nextMonthBtn = document.getElementById('next-month-btn');
                const summaryToday = document.getElementById('summary-today');
                const summaryPayPeriod = document.getElementById('summary-pay-period');
                const summaryTotal = document.getElementById('summary-total');
                const sidePanelContainer = document.getElementById('side-panel-container');
                const sidePanelBackdrop = document.getElementById('side-panel-backdrop');
                const closeSidePanelBtn = document.getElementById('close-side-panel-btn');
                const displaySelectedDate = document.getElementById('display-selected-date');
                const addSessionBtn = document.getElementById('add-session-btn');
                const sessionsDisplayArea = document.getElementById('sessions-display-area');
                const additionalHoursDisplayArea = document.getElementById('additional-hours-display-area');
                const displayDayTotal = document.getElementById('display-day-total');
                const noHoursMessage = document.getElementById('no-hours-message');
                const timeEntryModal = document.getElementById('time-entry-modal');
                const closeEntryModalBtn = document.getElementById('close-entry-modal-btn');
                const modalTitle = document.getElementById('modal-title');
                const modalSelectedDate = document.getElementById('modal-selected-date');
                const timeInInput = document.getElementById('time-in');
                const timeOutInput = document.getElementById('time-out');
                const timeInContainer = document.getElementById('time-in-container');
                const timeOutContainer = document.getElementById('time-out-container');
                const hourTypeContainer = document.getElementById('hour-type-container');
                const additionalHoursInput = document.getElementById('additional-hours');
                const additionalHoursContainer = document.getElementById('additional-hours-container');
                const hourTypeButtons = document.querySelectorAll('.hour-type-btn');
                const saveBtn = document.getElementById('save-btn');
                const settingsBtn = document.getElementById('settings-btn');
                const closeSettingsModalBtn = document.getElementById('close-settings-modal-btn');
                const settingsModal = document.getElementById('settings-modal');
                const themeSelect = document.getElementById('theme-select');
                const backgroundSelect = document.getElementById('background-select');
                const payPeriodSelect = document.getElementById('pay-period-select');
                const clearDataBtn = document.getElementById('clear-data-btn');
                const confirmModal = document.getElementById('confirm-modal');
                const confirmMessage = document.getElementById('confirm-message');
                const confirmOkBtn = document.getElementById('confirm-ok-btn');
                const confirmCancelBtn = document.getElementById('confirm-cancel-btn');
                const notificationToast = document.getElementById('notification-toast');
                const notificationMessage = document.getElementById('notification-message');
                const turnInHoursBtn = document.getElementById('turn-in-hours-btn');
                const timesheetModal = document.getElementById('timesheet-modal');
                const closeTimesheetModalBtn = document.getElementById('close-timesheet-modal-btn');
                const closeTimesheetBtnBottom = document.getElementById('close-timesheet-btn-bottom');
                const timesheetOutput = document.getElementById('timesheet-output');
                const copyTimesheetBtn = document.getElementById('copy-timesheet-btn');
                const clockInBtn = document.getElementById('clock-in-btn');
                const clockOutBtn = document.getElementById('clock-out-btn');
                const clockOutTypeModal = document.getElementById('clock-out-type-modal');
                const confirmAcapBtn = document.getElementById('confirm-acap-btn');
                const confirmCoreBtn = document.getElementById('confirm-core-btn');
                const clockOutCancelBtn = document.getElementById('clock-out-cancel-btn');
                const backgroundContainer = document.getElementById('background-animation-container');
                const viewStatsBtn = document.getElementById('view-stats-btn');
                const statsModal = document.getElementById('stats-modal');
                const closeStatsModalBtn = document.getElementById('close-stats-modal-btn');
                const achievementToast = document.getElementById('achievement-toast');
                const achievementIcon = document.getElementById('achievement-icon');
                const achievementTitle = document.getElementById('achievement-title');
                const achievementDescription = document.getElementById('achievement-description');
                const achievementChime = document.getElementById('achievement-chime');
                const viewAchievementsBtn = document.getElementById('view-achievements-btn');
                const achievementsModal = document.getElementById('achievements-modal');
                const closeAchievementsModalBtn = document.getElementById('close-achievements-modal-btn');
                const achievementsList = document.getElementById('achievements-list');

                // --- STATE & DEFINITIONS ---
                let currentDate = new Date();
                let selectedDate = null;
                let editingSessionIndex = -1;
                let timeData = {};
                let settings = { theme: 'Sakura', background: 'none', payPeriod: 14 };
                let achievementsData = {};
                let modalHourType = 'CORE';
                let onConfirmCallback = null;
                let notificationTimeout, achievementTimeout;

                const achievementDefinitions = {
                    firstClockIn:    { title: "First Sunrise", description: "You've clocked in for the first time.", icon: "🌅" },
                    firstClockOut:   { title: "First Sunset", description: "You've completed your first session.", icon: "🌇" },
                    weekly10:        { title: "Steady Start", description: "Reached 10 hours in a single week.", icon: "🌱" },
                    weekly20:        { title: "Halfway Hustler", description: "Reached 20 hours in a single week.", icon: "🏃‍♀️" },
                    weekly40:        { title: "Full Week Warrior", description: "Reached 40 hours in a single week.", icon: "🏆" },
                    firstPayPeriod:  { title: "Payday Pioneer", description: "Completed your first two-week period.", icon: "💌" },
                    firstMonth:      { title: "Monthly Milestone", description: "You've been tracking for a month!", icon: "🗓️" },
                    sixMonths:       { title: "Half-Year Hero", description: "Six months of dedication!", icon: "🌟" },
                    oneYear:         { title: "Anniversary Achiever", description: "A whole year! Incredible commitment.", icon: "🎉" },
                    quickSip:        { title: "A Quick Sip", description: "Logged a session less than an hour.", icon: "☕" },
                    dynamicDuo:      { title: "Dynamic Duo", description: "Logged both ACAP and CORE in one day.", icon: "🤝" }
                };
                const themes = {
                    default: { '--bg-primary': '#F3EAD3', '--bg-secondary': '#FFFFFF', '--text-primary': '#4A4A4A', '--text-secondary': '#7A7A7A', '--accent-primary': '#86A8E7', '--accent-secondary': '#91EAE4', '--border-default': '#D9D9D9' },
                    'Oceanic': { '--bg-primary': '#0B2027', '--bg-secondary': '#12343B', '--text-primary': '#E0FBFC', '--text-secondary': '#96C5D9', '--accent-primary': '#3EF7B2', '--accent-secondary': '#00B4D8', '--border-default': 'rgba(150, 197, 217, 0.4)' },
                    'Sakura': { '--bg-primary': '#F9F1F1', '--bg-secondary': '#FFFFFF', '--text-primary': '#5B4242', '--text-secondary': '#8D6E6E', '--accent-primary': '#E6A4B4', '--accent-secondary': '#FFB7C5', '--border-default': '#E6DEDE' },
                };

                // --- CORE FUNCTIONS ---
                function saveData() { localStorage.setItem('timeTrackerData', JSON.stringify(timeData)); localStorage.setItem('timeTrackerAchievements', JSON.stringify(achievementsData)); }
                function loadData() { const d = localStorage.getItem('timeTrackerData'); if (d) timeData = JSON.parse(d); const a = localStorage.getItem('timeTrackerAchievements'); if (a) achievementsData = JSON.parse(a); }
                function saveSettings() { localStorage.setItem('timeTrackerSettings', JSON.stringify(settings)); }
                function loadSettings() { const s = localStorage.getItem('timeTrackerSettings'); if (s) settings = { ...settings, ...JSON.parse(s) }; }
                function getDateString(date) { return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`; }

                function calculateHours(dateStr) {
                    const entry = timeData[dateStr];
                    if (!entry) return 0;
                    let duration = (entry.sessions || []).reduce((total, session) => {
                        if (session.in && session.out) {
                            const timeIn = new Date(`${dateStr}T${session.in}`);
                            const timeOut = new Date(`${dateStr}T${session.out}`);
                            if (timeOut > timeIn) return total + (timeOut - timeIn);
                        }
                        return total;
                    }, 0) / 3600000;
                    return duration + (entry.additional || 0);
                }

                function updateAllUI() { renderCalendar(); updateSummaries(); if (selectedDate) updateDisplayPanel(selectedDate); checkAchievements(); }
                
                function renderCalendar() {
                    calendarGrid.innerHTML = '';
                    const month = currentDate.getMonth(), year = currentDate.getFullYear();
                    monthYearHeader.textContent = `${currentDate.toLocaleString('default', { month: 'long' })} ${year}`;
                    ['S','M','T','W','T','F','S'].forEach(d => { const e = document.createElement('div'); e.className = 'font-bold text-secondary text-sm py-2'; e.textContent = d; calendarGrid.appendChild(e); });
                    const firstDayOfMonth = new Date(year, month, 1).getDay();
                    for (let i = 0; i < firstDayOfMonth; i++) calendarGrid.appendChild(document.createElement('div'));
                    const daysInMonth = new Date(year, month + 1, 0).getDate();
                    const today = new Date();
                    for (let day = 1; day <= daysInMonth; day++) {
                        const dayEl = document.createElement('button');
                        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        dayEl.textContent = day;
                        dayEl.className = 'p-2 rounded-lg transition-all duration-200 aspect-square flex items-center justify-center border';
                        dayEl.dataset.date = dateStr;
                        if (selectedDate === dateStr) { dayEl.style.borderColor = 'var(--accent-primary)'; dayEl.classList.add('border-2'); } else { dayEl.style.borderColor = 'var(--border-default)'; }
                        if (timeData[dateStr] && calculateHours(dateStr) > 0) { dayEl.style.backgroundColor = 'var(--accent-secondary)'; dayEl.classList.add('font-bold', 'text-white'); }
                        if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) { dayEl.classList.add('font-extrabold'); }
                        calendarGrid.appendChild(dayEl);
                    }
                }

                function updateSummaries() {
                    const todayStr = getDateString(new Date());
                    summaryToday.textContent = `${calculateHours(todayStr).toFixed(2)}h`;
                    summaryTotal.textContent = `${Object.keys(timeData).reduce((a, d) => a + calculateHours(d), 0).toFixed(2)}h`;
                    let periodHours = 0; const today = new Date();
                    for (let i = 0; i < settings.payPeriod; i++) { const date = new Date(); date.setDate(today.getDate() - i); periodHours += calculateHours(getDateString(date)); }
                    summaryPayPeriod.textContent = `${periodHours.toFixed(2)}h`;
                }

                function updateDisplayPanel(dateStr) {
                    if (!timeData[dateStr]) { timeData[dateStr] = { sessions: [], additional: 0 }; }
                    const entry = timeData[dateStr];
                    const dateObj = new Date(`${dateStr}T00:00:00`);
                    displaySelectedDate.textContent = dateObj.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    sessionsDisplayArea.innerHTML = '';
                    (entry.sessions || []).forEach((session, index) => {
                        const sEl = document.createElement('div');
                        sEl.className = 'p-3 rounded-lg flex items-center gap-2'; sEl.style.backgroundColor = 'var(--bg-primary)';
                        sEl.innerHTML = `<div class="flex-grow"><div class="flex justify-between items-center text-sm"><span>${session.in||'--:--'} - ${session.out||'...'}</span><span class="font-bold">${session.type||'N/A'}</span></div></div><div class="flex items-center"><button class="p-1 hover:text-blue-500" title="Edit Session" data-action="edit" data-index="${index}"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="pointer-events-none"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></button><button class="p-1 hover:text-red-500" title="Delete Session" data-action="delete" data-index="${index}"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="pointer-events-none"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button></div>`;
                        sessionsDisplayArea.appendChild(sEl);
                    });
                    additionalHoursDisplayArea.innerHTML = `<div class="flex justify-between items-center p-3 rounded-lg" style="background-color:var(--bg-primary);"><div class="flex-grow"><div class="flex justify-between items-center text-sm"><span>Additional Hours:</span><span class="font-bold">${(entry.additional||0).toFixed(2)}h</span></div></div><button class="p-1 hover:text-blue-500 ml-2" title="Edit Additional Hours" data-action="edit-additional"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="pointer-events-none"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></button></div>`;
                    displayDayTotal.textContent = `${calculateHours(dateStr).toFixed(2)}h`;
                    noHoursMessage.classList.toggle('hidden', calculateHours(dateStr) > 0);
                }

                function checkAchievements() {
                    const allDates = Object.keys(timeData).sort();
                    if (allDates.length === 0) return;
                    if (Object.values(timeData).some(d=>(d.sessions||[]).length>0)) unlockAchievement('firstClockIn');
                    if (Object.values(timeData).some(d=>(d.sessions||[]).some(s=>s.in&&s.out))) unlockAchievement('firstClockOut');
                    const firstDay = new Date(allDates[0]+'T00:00:00'), lastDay = new Date(allDates[allDates.length-1]+'T00:00:00');
                    const dayDiff = (lastDay - firstDay)/(1000*3600*24);
                    if (dayDiff >= 14) unlockAchievement('firstPayPeriod');
                    if (dayDiff >= 30) unlockAchievement('firstMonth');
                    if (dayDiff >= 182) unlockAchievement('sixMonths');
                    if (dayDiff >= 365) unlockAchievement('oneYear');
                    const weeklyHours={};
                    for(const dateStr of allDates) {
                        const date=new Date(dateStr+'T00:00:00');
                        const firstDayOfWeek=new Date(date.setDate(date.getDate()-date.getDay()));
                        const weekKey=getDateString(firstDayOfWeek);
                        if(!weeklyHours[weekKey])weeklyHours[weekKey]=0;
                        weeklyHours[weekKey]+=calculateHours(dateStr);
                        const types=new Set((timeData[dateStr].sessions||[]).map(s=>s.type));
                        if(types.has('ACAP')&&types.has('CORE'))unlockAchievement('dynamicDuo');
                    }
                    if (Object.values(weeklyHours).some(h=>h>=10)) unlockAchievement('weekly10');
                    if (Object.values(weeklyHours).some(h=>h>=20)) unlockAchievement('weekly20');
                    if (Object.values(weeklyHours).some(h=>h>=40)) unlockAchievement('weekly40');
                }
                function unlockAchievement(id) { if (!achievementsData[id]) { achievementsData[id] = true; saveData(); showAchievementNotification(id); } }
                function showAchievementNotification(id) {
                    clearTimeout(achievementTimeout);
                    const achievement = achievementDefinitions[id];
                    achievementIcon.textContent = achievement.icon;
                    achievementTitle.textContent = achievement.title;
                    achievementDescription.textContent = achievement.description;
                    achievementChime.currentTime = 0;
                    achievementChime.play().catch(e => console.error("Audio play failed:", e));
                    achievementToast.classList.add('show');
                    achievementTimeout = setTimeout(() => achievementToast.classList.remove('show'), 5000);
                }
                function showNotification(message) { clearTimeout(notificationTimeout); notificationMessage.textContent = message; notificationToast.classList.add('show'); notificationTimeout = setTimeout(() => notificationToast.classList.remove('show'), 3000); }
                function openTimeEntryModal(dateStr, sessionIndex=-1) {
                    editingSessionIndex = sessionIndex;
                    const entry = timeData[dateStr] || { sessions: [], additional: 0 };
                    modalSelectedDate.textContent = new Date(`${dateStr}T00:00:00`).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    const isAdd = sessionIndex === 'additional';
                    [timeInContainer, timeOutContainer, hourTypeContainer].forEach(el => el.style.display = isAdd ? 'none' : 'block');
                    additionalHoursContainer.style.display = isAdd ? 'block' : 'none';
                    if (isAdd) { modalTitle.textContent = "Edit Additional Hours"; additionalHoursInput.value = entry.additional || ''; }
                    else if (sessionIndex >= 0 && entry.sessions[sessionIndex]) { const s = entry.sessions[sessionIndex]; modalTitle.textContent = "Edit Session"; timeInInput.value = s.in || ''; timeOutInput.value = s.out || ''; modalHourType = s.type || 'CORE'; }
                    else { modalTitle.textContent = "Add New Session"; [timeInInput.value,timeOutInput.value] = ['','']; modalHourType = 'CORE'; }
                    hourTypeButtons.forEach(b => b.classList.toggle('btn-primary', b.dataset.type === modalHourType) || b.classList.toggle('btn-secondary', b.dataset.type !== modalHourType));
                    timeEntryModal.classList.add('active');
                }

                // --- INITIALIZATION & EVENT LISTENERS ---
                loadSettings();
                loadData();

                // Setup UI based on loaded settings
                const themes = { default: {}, Oceanic: {'--bg-primary':'#0B2027','--bg-secondary':'#12343B','--text-primary':'#E0FBFC','--text-secondary':'#96C5D9','--accent-primary':'#3EF7B2','--accent-secondary':'#00B4D8','--border-default':'rgba(150,197,217,0.4)'}, Sakura: {'--bg-primary':'#F9F1F1','--bg-secondary':'#FFFFFF','--text-primary':'#5B4242','--text-secondary':'#8D6E6E','--accent-primary':'#E6A4B4','--accent-secondary':'#FFB7C5','--border-default':'#E6DEDE'} };
                Object.keys(themes).forEach(n => themeSelect.add(new Option(n, n)));
                themeSelect.value = settings.theme;
                Object.keys(themes[settings.theme]).forEach(k => document.documentElement.style.setProperty(k, themes[settings.theme][k]));
                backgroundSelect.value = settings.background;
                if(settings.background === 'gradient') document.body.classList.add('animated-gradient');
                payPeriodSelect.value = settings.payPeriod;

                updateAllUI();

                // Attach all event listeners
                calendarGrid.addEventListener('click', e => {
                    if (e.target.matches('button[data-date]')) {
                        selectedDate = e.target.dataset.date;
                        updateAllUI();
                        if (timeData[selectedDate] && calculateHours(selectedDate) > 0) { sidePanelContainer.classList.add('active'); } 
                        else { openTimeEntryModal(selectedDate); }
                    }
                });
                prevMonthBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(); });
                nextMonthBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(); });
                sessionsDisplayArea.addEventListener('click', e => { const t = e.target.closest('button'); if(t){ const {action,index}=t.dataset; if(action==='edit')openTimeEntryModal(selectedDate,parseInt(index));if(action==='delete'){showConfirm('Delete session?',()=>{if(timeData[selectedDate]?.sessions[index]){timeData[selectedDate].sessions.splice(index,1);saveData();updateAllUI();}})}});
                additionalHoursDisplayArea.addEventListener('click', e => { if(e.target.closest('button')?.dataset.action==='edit-additional')openTimeEntryModal(selectedDate,'additional'); });
                addSessionBtn.addEventListener('click', () => { openTimeEntryModal(selectedDate); sidePanelContainer.classList.remove('active'); });
                saveBtn.addEventListener('click', () => { if(!selectedDate)return;if(!timeData[selectedDate])timeData[selectedDate]={sessions:[],additional:0};if(editingSessionIndex==='additional'){timeData[selectedDate].additional=parseFloat(additionalHoursInput.value)||0;}else{const s={in:timeInInput.value,out:timeOutInput.value,type:modalHourType};if(editingSessionIndex>=0){timeData[selectedDate].sessions[editingSessionIndex]=s;}else{timeData[selectedDate].sessions.push(s);}}saveData();updateAllUI();timeEntryModal.classList.remove('active');showNotification('Hours saved!'); });
                clockInBtn.addEventListener('click',()=>{const now=new Date(),todayStr=getDateString(now);if(!timeData[todayStr])timeData[todayStr]={sessions:[],additional:0};if(timeData[todayStr].sessions.find(s=>s.in&&!s.out)){showNotification('Already clocked in.');return;}const t=new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit',hour12:false});timeData[todayStr].sessions.push({in:t});selectedDate=todayStr;saveData();updateAllUI();showNotification(`Clocked in: ${t}`);sidePanelContainer.classList.add('active');});
                clockOutBtn.addEventListener('click',()=>{const todayStr=getDateString(new Date());if(!timeData[todayStr]?.sessions.find(s=>s.in&&!s.out)){showNotification('Not clocked in.');return;}clockOutTypeModal.classList.add('active');});
                [confirmAcapBtn,confirmCoreBtn].forEach(b=>b.addEventListener('click',e=>{const type=e.target.id.includes('acap')?'ACAP':'CORE';const now=new Date(),todayStr=getDateString(now);const openIdx=timeData[todayStr].sessions.findIndex(s=>s.in&&!s.out);if(openIdx>-1){const t=now.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit',hour12:false});timeData[todayStr].sessions[openIdx].out=t;timeData[todayStr].sessions[openIdx].type=type;const dur=(new Date(`${todayStr}T${t}`)-new Date(`${todayStr}T${timeData[todayStr].sessions[openIdx].in}`))/36e5;if(dur>0&&dur<1)unlockAchievement('quickSip');saveData();updateAllUI();clockOutTypeModal.classList.remove('active');showNotification(`Clocked out: ${t}`);sidePanelContainer.classList.add('active');}}));
                payPeriodSelect.addEventListener('change', e => { settings.payPeriod = parseInt(e.target.value, 10); saveSettings(); updateSummaries(); });
                themeSelect.addEventListener('change', e => { const t = themes[e.target.value]; Object.keys(t).forEach(k=>document.documentElement.style.setProperty(k, t[k])); settings.theme=e.target.value; saveSettings(); });
                backgroundSelect.addEventListener('change', e => { document.body.classList.toggle('animated-gradient', e.target.value==='gradient'); settings.background=e.target.value; saveSettings(); });
                clearDataBtn.addEventListener('click', () => showConfirm('Delete all entries and achievements?',()=>{timeData={};achievementsData={};saveData();updateAllUI();showNotification('All data cleared.');}));
                hourTypeButtons.forEach(b=>b.addEventListener('click',()=>hourTypeButtons.forEach(btn=>btn.classList.toggle('btn-primary',btn===b)||btn.classList.toggle('btn-secondary',btn!==b))||(modalHourType=b.dataset.type)));
                viewAchievementsBtn.addEventListener('click',()=>{achievementsModal.classList.add('active');achievementsList.innerHTML='';Object.keys(achievementDefinitions).forEach(id=>{const a=achievementDefinitions[id],isUnlocked=!!achievementsData[id],i=document.createElement('div');i.className=`achievement-item p-4 rounded-lg flex items-center gap-4 border ${isUnlocked?'unlocked':''}`;i.style.borderColor='var(--border-default)';if(isUnlocked)i.style.backgroundColor='var(--bg-primary)';i.innerHTML=`<div class="text-3xl">${a.icon}</div><div><p class="font-bold text-primary">${a.title}</p><p class="text-sm text-secondary">${a.description}</p></div>`;achievementsList.appendChild(i);})});
                // Close modals
                [closeSidePanelBtn, sidePanelBackdrop].forEach(el=>el.addEventListener('click',()=>sidePanelContainer.classList.remove('active')));
                [closeEntryModalBtn, closeSettingsModalBtn, closeStatsModalBtn, clockOutCancelBtn, closeAchievementsModalBtn, confirmCancelBtn, closeTimesheetModalBtn, closeTimesheetBtnBottom].forEach(el=>el.addEventListener('click',()=>el.closest('.modal-backdrop').classList.remove('active')));
                confirmOkBtn.addEventListener('click', () => { if (onConfirmCallback) onConfirmCallback(); confirmModal.classList.remove('active'); });

            } catch (error) {
                console.error("Critical initialization error:", error);
                document.body.innerHTML = `<div style="padding: 2rem; text-align: center; font-family: sans-serif; color: #333; background-color: #fffbe6;">
                    <h1 style="color: #d9534f;">Oh no! A critical error occurred.</h1>
                    <p style="margin: 1rem 0;">The application could not start. This is a bug in the code. Please copy the error message below and send it back for a fix.</p>
                    <pre style="background: #f9f2f4; color: #c7254e; padding: 1rem; border-radius: 8px; text-align: left; white-space: pre-wrap; word-break: break-all; border: 1px solid #d6d6d6;">${error.stack}</pre>
                </div>`;
            }
        };
    </script>
</body>
</html>
